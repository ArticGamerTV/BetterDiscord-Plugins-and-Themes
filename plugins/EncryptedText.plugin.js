var BetterAPI=BetterAPI||bdplugins.BetterAPI.plugin.constructor,EncryptedText=function(){};EncryptedText.prototype.parseChat=function(){$(".message-text>.markup>span:not(.EncryptedText_parsed").each(function(a,b){var e,c=$(b),d=c.text();if(d.startsWith("[!o]")){try{e=d.split("[!o]")[1]}catch(c){return}try{e=EncryptedText.decodeBase64(e)}catch(c){return}e&&(BetterAPI.isEmpty(e)||c.html(d.replace(d,'<img width="16px" src="/assets/d72f52ce6c418c5c8fd5faac0e8c36ff.svg"/> '+e)))}if(d.startsWith("[!e]")){try{e=d.split("[!e]")[1]}catch(c){return}try{e=EncryptedText.decryptBase64(e)}catch(c){return}e&&(BetterAPI.isEmpty(e)||c.html(d.replace(d,'<img width="16px" src="/assets/86c36b8437a0bc80cf310733f54257c2.svg"/> '+e)))}}).addClass("EncryptedText_parsed")},EncryptedText.prototype.load=function(){},EncryptedText.prototype.start=function(){var _require=["BetterAPI","https://raw.githubusercontent.com/Bluscream/BetterDiscord-Plugins-and-Themes/master/plugins/0_BetterAPI.plugin.js","BetterAPI.isDebug()"];if(null===BdApi.getPlugin(_require[0]))return Core.prototype.alert("Required plugin not found!","A requirement is missing: <b>"+_require[0]+'</b><br><br>Click <a style=""href="#" onClick="require(\'shell\').openExternal(\'http://betterdiscord.net/ghdl?url='+_require[1]+'\')">here</a> to download the plugin.<br>Save the downloaded file to "'+process.env.APPDATA+'BetterDiscord\\plugins\\".'),null;try{eval(_require[2])}catch(e){return Core.prototype.alert("Requirement not started!","A requirement is not started: <b>"+_require[0]+"<b><br><br>Click <a onClick=\"$('.btn-settings').click();setTimeout(function(){ $('#bd-settings-new').click();setTimeout(function(){ $('#"+_require[0]+"').prop('checked', true); }, 750); }, 500);\">here</a> to enable it.<br>"),null}BetterAPI.requireJS("https://cdn.rawgit.com/sytelus/CryptoJS/master/rollups/aes.js","AESJS",'CryptoJS.AES.encrypt("Message", "Secret Passphrase");'),this.attachHandler(),this.parseChat(),_require=null},EncryptedText.prototype.onSwitch=function(){this.attachHandler(),this.parseChat()},EncryptedText.prototype.onMessage=function(){this.parseChat()},EncryptedText.prototype.observer=function(a){null!=a.target.getAttribute("class")&&-1!=a.target.getAttribute("class").indexOf("comment")&&a.addedNodes.length>0&&1!=a.addedNodes[0].className.indexOf("message")&&this.parseChat()},EncryptedText.prototype.stop=function(){},EncryptedText.prototype.unload=function(){},EncryptedText.prototype.getName=function(){return"Encrypted Text"},EncryptedText.prototype.getDescription=function(){return"Allows you to send encrypted texts"},EncryptedText.prototype.getVersion=function(){return"1"},EncryptedText.prototype.getAuthor=function(){return"EhsanKia, Bluscream"},EncryptedText.prototype.attachHandler=function(){var a=$(".channel-textarea textarea");if(0!=a.length){this.handleKeypress=function(a){var b=a.keyCode||a.which;if(13===b){var c;try{var d=$(".channel-textarea textarea").val();d.startsWith("/o ")&&(c=d.split("/o "),c=EncryptedText.encodeBase64(c[1]),c="[!o]"+c,EncryptedText.sendTextMessage(c),$(this).val(""),a.preventDefault(),a.stopPropagation()),d.startsWith("/e ")&&(c=d.split("/e "),c=EncryptedText.encryptBase64(c[1]),c="[!e]"+c,EncryptedText.sendTextMessage(c),$(this).val(""),a.preventDefault(),a.stopPropagation())}catch(a){}}},a[0].addEventListener("keydown",this.handleKeypress,!1)}},EncryptedText.prototype.getSettingsPanel=function(){},EncryptedText.encryptBase64=function(a){return CryptoJS.AES.encrypt(a,"QWxsb3dzIHlvdSB0byBzZW5kIGVuY3J5cHRlZCB0ZXh0cw==").toString()},EncryptedText.decryptBase64=function(a){return CryptoJS.AES.decrypt(a,"QWxsb3dzIHlvdSB0byBzZW5kIGVuY3J5cHRlZCB0ZXh0cw==").toString(CryptoJS.enc.Utf8)},EncryptedText.encodeBase64=function(a){return btoa(a)},EncryptedText.decodeBase64=function(a){return atob(a)},EncryptedText.sendTextMessage=function(a){var b=new FormData;b.append("content",a),$.ajax({type:"POST",url:"https://discordapp.com/api/channels/"+window.location.pathname.split("/").pop()+"/messages",headers:{authorization:localStorage.token.slice(1,-1)},data:b,processData:!1,contentType:!1})},exports.EncryptedText=EncryptedText;